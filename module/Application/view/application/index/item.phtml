<?php 
	$k = $this->item;
	
	if (method_exists($k, "setSolution")) {
		$type = "task";
	} else {
		$type = "knowledge";
	}
	
	$text = $k->getDescription();
	
	$ferrors = $this->formErrors;
	
?>

<div class="wrapp">
	<?php 
	if ($ferrors) 
	{
		echo "<div>" . print_r($ferrors) . "</div>";
	}
	?>

    <div style="margin-bottom:20px;" class="ccbox mainwrapper">
    	
    	
    	<h2><strong><?=$type=="task" ? "Aufgabenstellung" : "Wissen"?></strong></h2>
 		<?php 
    	echo $k->getTechnology()->getName();
    	if (null !== $k->getCompany()) {
			echo " --- " . $k->getCompany()->getName();
		}
		echo '<div class="recommendations-wrapper">';
		echo '<div class="recommendation">';
		
		echo "<pre>{$text}</pre>";
		
		echo '</div></div>';
		?>
		<br>
		
    	<?php
    	if (null !== $k->getTags()) {
			echo "<h3>Tags:</h3>";
			
    		foreach ($k->getTags() as $t) {
				if ($t->getName() !== "") {
					echo "<form method='POST' id='{$t->getId()}' name='{$t->getId()}' action='../results' >";
					echo "<input name='query' value='{$t->getName()}' hidden>";
					echo "<button type='submit' class='tag'>{$t->getName()}</button> ";
					echo "</form>";
				}
			}
    	}
    	?>
    	<br>
    	<br>
    	<br>
    	<?php 
    		echo "<p class='small'>Erstellt am " . $k->getCreated()->format("d.m.Y H:i")
    			. " von {$k->getAuthor()->getFullname()}</p>"; 
    	?>
    		
    	<?php 
    	if ($k->getUpdated() != $k->getCreated() )
    	{
    		echo "<p class='small'>Zuletzt geändert am " . $k->getUpdated()->format("d.m.Y H:i")
    		. " von {$k->getAuthor()->getFullname()}</p>"; 
    	}	
    	?>
    </div>
    <?php 
    	if ($type == "task" && !$k->getStatus()) {
    		echo '<div class="ccbox mainwrapper" style="margin-left:10px;">';
			echo "<h2><strong>Deine Lösung</strong></h2>";
    		echo "<form method='post' id='solution-form'>";
	    		echo "<textarea name='solution' rows='5' cols='51'></textarea>";
	    		echo "<br>";
	    		echo "<button type='submit' form='solution-form'>Aufgabe abschließen</button>";
	    	echo "</form>";
	    }
   	 echo "</div>";
    ?>
    
    <?php 
    	if (isset($this->reccs)) {
	   		echo '<div class="rec-div ccbox mainwrapper">';
	    	echo "<h2><strong>Empfehlungen</strong></h2>";
	    	foreach ($this->reccs as $r) {
				echo "<h3>Wertigkeit: {$r["score"]}</h3>";
				echo "<div data-id='{$r["id"]}' class='recommendation'><p>{$r["description"]}</p></div>";
			}
		}
		
    	if (isset($this->solution)) {
	   		echo '<div class="rec-div ccbox mainwrapper">';
	    	echo "<h2><strong>Lösung</strong></h2>";
			echo "<div class='solution'><pre>{$this->solution}</pre></div>";
		}
	?>
    </div>
    
</div>